#!/usr/local/bin/perl
use strict;


my @months = qw(Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec);
(my $second, my $minute, my $hour, my $dayOfMonth, my $month, my $yearOffset, my $dayOfWeek, my $dayOfYear, my $daylightSavings) = localtime();
my $time = "$months[$month]_${dayOfMonth}_$hour:$minute:$second";

print "\nTo use default values wherever available, press Enter\n";

print "  Enter Command : ";
chomp(my $command=<>);

print "  Enter Job Name (default=localtime) : ";
chomp(my $J=<>);

print "  Select Queue (default=short)";
print "\n    Options : s(hort)/n(ormal)/r(egress)/g(ui) : ";
chomp(my $Q=<>);

my $I="";
my $II="\b";
if ($Q=~/^g(ui)?$/i){
	print "    Is it Interactive? (y/n) (default:No) : ";
	chomp($I=<>);
	$II = "-I";
}


print "  Select Priority. Type just the number (default:omitted) : ";
chomp(my $S=<>);


print "  Select Machine. Type name with quotes (default=ws40) : ";
chomp(my $R=<>);


my $res = "\b";
print "  Punch intermediate results? (default:No) : ";
chomp(my $res_ans=<>);
if ($res_ans=~/Y(es)?/i){
	print "    Start Punching at    : ";
	chomp(my $res_start=<>);
	print "    Enter Punch Interval : ";
	chomp(my $res_int=<>);
	$res = "-results $res_start,$res_int";
}


my $log = "\b";
print "  Save Log? (default:No) : ";
chomp(my $log_ans=<>);
if ($log_ans=~/Y(es)?/i){
	my $log = "-o $J.log";
}
	


my $P="-P P0:IO_10015123";

my $QQ="";
$QQ="-q short"	if (($Q=~/s(hort)?/i)||($Q eq ""));
$QQ="-q normal"  if ($Q=~/n(ormal)?/i);
$QQ="-q regress" if ($Q=~/r(egress)?/i);
$QQ="-q gui" 	 if ($Q=~/g(ui)?/i);

my $RR = ($R eq "" ? "-R ws40" : "-R $R");

my $SS = ($S eq "" ? "\b" : "-sp $S");

my $JJ = ($J eq "" ? "-J $time" : "-J $J");

my $comm="/usr/local/lsf/bin/bsub $P $QQ $II $RR $SS $JJ $log $command $res";
print "Command :\n  $comm";

print "\n\n";

print "\n  Execute? (default:Yes) : ";
chomp(my $exec=<>);
if ($exec=~/No?/i){
   exit(0);
}else{
   system("/usr/local/lsf/bin/bsub $P $QQ $II $RR $SS $JJ $log $command $res");
}
